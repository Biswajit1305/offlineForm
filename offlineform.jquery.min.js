(function(b){var e={key:"offlineForm",classname:"offlineForm",onlineAjaxSend:false,beforeSync:null,afterSync:null,onSync:null,onStorage:null,onError:null,onlineAjaxCallback:null};var d=e;function c(){form=b(this);if(navigator.onLine){if(d.onlineAjaxSend){b.ajax({type:form.attr("method"),url:form.attr("action"),data:form.serialize(),success:function(f){if(d.onlineAjaxCallback){d.onlineAjaxCallback(f)}}}).fail(function(f){if(d.onError){d.onError(f)}return false});return false}return true}action=form.attr("action");if(action===""){action=document.location.href}if(localStorage[d.key]===undefined){localStorage[d.key]=JSON.stringify([])}data=JSON.parse(localStorage[d.key]);if(data.length){b.each(data,function(f,g){if(g===null){data.splice(f,1)}})}data.push({action:action,urlEncoded:form.serialize()});if(d.onStorage){d.onStorage(data.length)}localStorage[d.key]=JSON.stringify(data);return false}var a={init:function(f){return this.each(function(){d=b.extend(d,f);form=b(this);if(!form.hasClass(d.classname)){form.on("submit",c);form.addClass(d.classname)}})},sync:function(){if(localStorage[d.key]===undefined){return false}else{data=JSON.parse(localStorage[d.key])}total=data.length;if(data!==undefined&&total>0){b.each(data,function(f,g){if(g===null){data.splice(f,1)}});total=data.length;if(d.beforeSync){d.beforeSync(total)}b.each(data,function(f,g){if(g){b.ajax({type:"POST",url:g.action,data:g.urlEncoded,async:false,success:function(h){if(d.onSync){d.onSync((f+1),total,h)}data.splice(f,1);localStorage[d.key]=JSON.stringify(data);if(data.length===0&&d.afterSync){d.afterSync(total)}}}).fail(function(h){data.splice(f,1);localStorage[d.key]=JSON.stringify(data);if(d.onError){d.onError(h)}return false})}});return true}return false}};b.fn.offlineForm=function(f){if(a[f]){return a[f].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof f==="object"||!f){return a.init.apply(this,arguments)}else{b.error("Method "+f+" does not exist on jQuery.offlineForm")}}}})(jQuery);
